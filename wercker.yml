# box: debian:stable-slim
box: node:current-alpine3.12
dowload:
    steps:
        - script:
          name: UI
          code: |
               echo "hello word"
               ls
               apk --no-cache add git
               apk add tree
               rm -rf Shetuankaif
               git clone -b kunpengUI https://gitee.com/mai-tao/Shetuankaif.git
               ls
               npm install --prefix ./Shetuankaif
               npm run build --prefix ./Shetuankaif
               ls
               rm -rf app/src/main/resource/public/*
               ls
               tree   app
               echo $WERCKER_ROOT
               echo $WERCKER_SOURCE_DIR
               cp -Rf Shetuankaif/dist/* app/src/main/resources/public
               echo "之后"
               tree   app
               rm -rf Shetuankaif
               ls

build:
    steps:
        - shellcheck:
            files: run.sh

        - install-packages:
            packages: curl

        - script:
            name: build shellcheck
            code: |
                curl -L https://s3.amazonaws.com/assets.heroku.com/heroku-client/heroku-client.tgz > /tmp/heroku-client.tgz
                mkdir /tmp/heroku/
                tar xzvf /tmp/heroku-client.tgz -C /tmp/heroku/

        - script:
            name: prepare output
            code: |
                mkdir -p $WERCKER_ROOT/vendor/heroku
                mv /tmp/heroku/heroku-client/* $WERCKER_ROOT/vendor/heroku
                rm -rf $WERCKER_ROOT/.git $WERCKER_ROOT/.gitignore

publish:
  steps:
    - internal/publish-step:
        owner: wercker

deploy:
  steps:
    - heroku-deploy:
        key: $HEROKU_KEY
        key-name: HEROKU_KEY_PAIR
        user: $HEROKU_USER
        app-name: $HEROKU_APP_NAME        